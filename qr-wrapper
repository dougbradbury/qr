#!/bin/bash

# QR Code Generator Wrapper Script
# Activates the virtual environment and runs the QR tool

QR_PROJECT_DIR="$HOME/Projects/qr-generator"
CURRENT_DIR="$(pwd)"

if [ ! -d "$QR_PROJECT_DIR" ]; then
    echo "Error: QR generator project not found at $QR_PROJECT_DIR" >&2
    exit 1
fi

# Run the QR generator from the project directory but save files in current directory
cd "$QR_PROJECT_DIR"
"$QR_PROJECT_DIR/qr_env/bin/python" qr "$@"

# If a file was created in the project directory, move it to the current directory
if [ $# -gt 0 ]; then
    # Check for -o/--output parameter
    output_file=""
    for ((i=1; i<=$#; i++)); do
        arg="${!i}"
        if [[ "$arg" == "-o" || "$arg" == "--output" ]]; then
            next_i=$((i+1))
            if [ $next_i -le $# ]; then
                output_file="${!next_i}"
            fi
            break
        fi
    done
    
    # If no output specified, use default
    if [ -z "$output_file" ]; then
        output_file="qr_code.png"
    fi
    
    # Move file to current directory if it exists and we're not already there
    if [ -f "$output_file" ] && [ "$CURRENT_DIR" != "$QR_PROJECT_DIR" ]; then
        mv "$output_file" "$CURRENT_DIR/"
    fi
fi